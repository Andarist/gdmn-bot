%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 1193786287_1320926323
  Name: "БОТ.Экспорт файлов"
  Caption: "БОТ.Экспорт файлов"
  Version: "1.0.0.6"
  Optional: False
  Internal: True
  MD5: 26016F2AA948451B3056CEF162411A19
Uses: 
  - "147029090_1220419898 GS.Общие.Функции работы с json"
Objects: 
  - 
    Properties: 
      Class: "TgdcConst"
      RUID: 1193786343_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "БОТ. Адрес сервера "
      COMMENT: ~
      CONSTTYPE: 0
      DATATYPE: "S"
      EDITIONDATE: 2020-03-31T12:16:25+03:00
  - 
    Properties: 
      Class: "TgdcConst"
      RUID: 1193786349_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "БОТ. ИД клиента"
      COMMENT: ~
      CONSTTYPE: 0
      DATATYPE: "S"
      EDITIONDATE: 2020-03-31T13:31:45+03:00
  - 
    Properties: 
      Class: "TgdcExplorer"
      RUID: 1193786363_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193786365_1320926323
    Fields: 
      PARENT: "710000_17 Исследователь"
      NAME: "Бот"
      CLASSNAME: ~
      CMD: "1193786363_1320926323"
      CMDTYPE: 0
      HOTKEY: ~
      IMGINDEX: 138
      ORDR: ~
      SUBTYPE: ~
      EDITIONDATE: 2020-03-31T13:54:25+03:00
      DISABLED: 0
  - 
    Properties: 
      Class: "TgdcExplorer"
      RUID: 1193786365_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "1193786363_1320926323 Исследователь\\Бот"
      NAME: "Экспорт видов начислений"
      CLASSNAME: ~
      CMD: "1193786366_1320926323"
      CMDTYPE: 1
      HOTKEY: ~
      IMGINDEX: 174
      ORDR: ~
      SUBTYPE: ~
      EDITIONDATE: 2020-03-31T14:33:55+03:00
      DISABLED: 0
  - 
    Properties: 
      Class: "TgdcExplorer"
      RUID: 1193786368_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      PARENT: "1193786363_1320926323 Исследователь\\Бот"
      NAME: "Экспорт расчетных листов"
      CLASSNAME: ~
      CMD: "1193786369_1320926323"
      CMDTYPE: 1
      HOTKEY: ~
      IMGINDEX: 174
      ORDR: ~
      SUBTYPE: ~
      EDITIONDATE: 2020-03-31T14:33:45+03:00
      DISABLED: 0
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 1193785048_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "bot_SendFile"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "UNKNOWN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-03-26T09:13:58+03:00
      DISPLAYSCRIPT: | 
        BOT_SENDFILE
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QEAAAASlNPTgQAAABKU09OAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEZOU1RQUlNU
        AwAAAFVSTAMAAABVUkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVEZMUFI=
      SCRIPT: | 
        Option Explicit
        
        ' Функция принимает на вход:
        '   Json файл.
        '   URL скрипта на сервере.
        '
        ' Данные передаются POST запросом.
        ' Возвращает True, если файл успешно передан.
        
        Function bot_SendFile(JSON, URL)
        
         On Error Resume Next
          dim oXMLHTTP
          Set oXMLHTTP = CreateObject("MSXML2.XMLHTTP")
          call oXMLHTTP.Open("POST", url, false)
          call oXMLHTTP.setRequestHeader("Content-Type", "application/json")
          on error resume next
          call oXMLHTTP.Send(JSON)
          on error goto 0
        
          If Err.Number <> 0 Then
            MsgBox "Ошибка передачи файла " & Err.Message
            bot_SendFile = False
          Else
            bot_SendFile = True
          End If
        
        End Function
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 1193786369_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "bot_exportPaySlips"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "UNKNOWN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-03-31T14:34:50+03:00
      DISPLAYSCRIPT: | 
        BOT_EXPORTPAYSLIPS
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      SCRIPT: | 
        '#include BOT_SENDFILE
        '#include BOT_PREPAREPAYSLIP
        Option Explicit
        Function bot_exportPaySlips(Period)
          dim gdcConst, URL, idBase, Creator
          set Creator = new TCreator
          set gdcConst = Creator.GetObject(NULL, "TgdcConst", "")
          URL = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786343_1320926323"))
          idBase = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786349_1320926323"))
        
          dim JSON, i
          call bot_PreparePaySlip (idBase, Period, JSON)
          for i = 0 to UBound(JSON) - 1
            bot_SendFile JSON(i), URL & "/upload"
          next
        End Function
        
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "1193785048_1320926323 bot_SendFile"
          - 
            ADDFUNCTIONKEY: "1193785764_1320926323 bot_PreparePaySlip"
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 1193786366_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "bot_exportAccDeds"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "UNKNOWN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-03-31T14:37:36+03:00
      DISPLAYSCRIPT: | 
        BOT_EXPORTACCDEDS
        
      ENTEREDPARAMS: ~
      SCRIPT: | 
        '#include BOT_SENDFILE
        '#include BOT_PREPAREACCDED
        Function bot_exportAccDeds
          dim gdcConst, URL, idBase, Creator
          set Creator = new TCreator
          set gdcConst = Creator.GetObject(NULL, "TgdcConst", "")
          URL = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786343_1320926323"))
          idBase = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786349_1320926323"))
        
          dim JSON
          call bot_PrepareAccDed (idBase, JSON)
          bot_SendFile JSON, URL & "/upload"
        End Function
        
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "1193785027_1320926323 bot_PrepareAccDed"
          - 
            ADDFUNCTIONKEY: "1193785048_1320926323 bot_SendFile"
  - 
    Properties: 
      Class: "TgdcReportGroup"
      RUID: 147023060_918566284
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193785045_1320926323
    Fields: 
      PARENT: ~
      NAME: "Отчеты(gdc_frmExplorer)11"
      DESCRIPTION: ~
      USERGROUPNAME: "147023060_781234916"
      EDITIONDATE: 2000-01-01T00:00:00+03:00
  - 
    Properties: 
      Class: "TgdcMacrosGroup"
      RUID: 147023059_918566284
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193785045_1320926323
    Fields: 
      PARENT: ~
      NAME: "Локальные макросы"
      CLASSNAME: ""
      ISGLOBAL: 0
      OBJECTNAME: "gdc_frmExplorer"
      OBJECTPARENT: ~
      SUBTYPE: ""
      EDITIONDATE: 2007-11-19T18:34:29+03:00
      DESCRIPTION: ~
  - 
    Properties: 
      Class: "TgdcDelphiObject"
      RUID: 147002113_781234916
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193785045_1320926323
    Fields: 
      PARENT: ~
      NAME: "gdc_frmExplorer"
      CLASSNAME: ""
      DESCRIPTION: ~
      MACROSGROUPKEY: "147023059_918566284 Локальные макросы"
      OBJECTNAME: "gdc_frmExplorer"
      OBJECTTYPE: 0
      REPORTGROUPKEY: "147023060_918566284 Отчеты(gdc_frmExplorer)11"
      SUBTYPE: ""
      EDITIONDATE: 2007-03-28T11:31:02+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 1193785047_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193785045_1320926323
    Fields: 
      NAME: "Macros1193785047_1320926323"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "MACROS"
      MODULECODE: "147002113_781234916 gdc_frmExplorer"
      OBJECTNAME: "gdc_frmExplorer"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-04-14T11:31:54+03:00
      DISPLAYSCRIPT: | 
        MACROS1193785047_1320926323
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNURkxQUg==
      SCRIPT: | 
        '#include BOT_SENDFILE
        '#include BOT_PREPAREACCDED
        Option Explicit
        Sub Macros1193785047_1320926323(OwnerForm)
          dim gdcConst, URL, idBase, Creator
          set Creator = new TCreator
          set gdcConst = Creator.GetObject(NULL, "TgdcConst", "")
          URL = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786343_1320926323"))
          if URL = "" then
            call Exception.Raise("Exception", "Не указана константа 'БОТ. Адрес сервера'. Экспорт не будет выполнен!")
          end if
          idBase = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786349_1320926323"))
          if idBase = "" then
            call Exception.Raise("Exception", "Не указана константа 'БОТ. ИД клиента'. Экспорт не будет выполнен!")
          end if
        
          dim JSON
          call bot_PrepareAccDed (idBase, JSON)
          bot_SendFile JSON, URL & "/upload"
        End Sub
        
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "1193785048_1320926323 bot_SendFile"
          - 
            ADDFUNCTIONKEY: "1193785027_1320926323 bot_PrepareAccDed"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 1193785045_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Бот. Экспорт видов начислений"
      DISPLAYINMENU: 1
      EXECUTEDATE: ~
      FUNCTIONKEY: "1193785047_1320926323 Macros1193785047_1320926323"
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      MACROSGROUPKEY: "147023059_918566284 Локальные макросы"
      OBJECTNAME: "gdc_frmExplorer"
      SERVERKEY: ~
      SHORTCUT: 0
      EDITIONDATE: 2020-04-14T11:31:55+03:00
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 1193785777_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 1193785775_1320926323
    Fields: 
      NAME: "Macros1193785047_13209263231193785777_1320926323"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "MACROS"
      MODULECODE: "147002113_781234916 gdc_frmExplorer"
      OBJECTNAME: "gdc_frmExplorer"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-04-14T11:32:06+03:00
      DISPLAYSCRIPT: | 
        MACROS1193785047_13209263231193785777_1320926323
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAABGTlNU
        RkxQUg==
      SCRIPT: | 
        '#include BOT_PREPAREPAYSLIP
        '#include BOT_SENDFILE
        Option Explicit
        Sub Macros1193785047_13209263231193785777_1320926323(Period)
          dim gdcConst, URL, idBase, Creator
          set Creator = new TCreator
          set gdcConst = Creator.GetObject(NULL, "TgdcConst", "")
          URL = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786343_1320926323"))
          if URL = "" then
            call Exception.Raise("Exception", "Не указана константа 'БОТ. Адрес сервера'. Экспорт не будет выполнен!")
          end if
          idBase = gdcConst.QGetValueByID(gdcBaseManager.GetIDByRUIDString("1193786349_1320926323"))
          if idBase = "" then
            call Exception.Raise("Exception", "Не указана константа 'БОТ. ИД клиента'. Экспорт не будет выполнен!")
          end if
        
          dim JSON, i
          call bot_PreparePaySlip (idBase, Period, JSON)
          for i = 0 to UBound(JSON) - 1
            bot_SendFile JSON(i), URL & "/upload"
          next
        End Sub
        
    Set: 
      - 
        Table: "RP_ADDITIONALFUNCTION"
        Items: 
          - 
            ADDFUNCTIONKEY: "1193785764_1320926323 bot_PreparePaySlip"
          - 
            ADDFUNCTIONKEY: "1193785048_1320926323 bot_SendFile"
  - 
    Properties: 
      Class: "TgdcMacros"
      RUID: 1193785775_1320926323
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Бот. Экспорт расчетных листов"
      DISPLAYINMENU: 1
      EXECUTEDATE: ~
      FUNCTIONKEY: "1193785777_1320926323 Macros1193785047_13209263231193785777_1320926323"
      ISLOCALEXECUTE: 0
      ISREBUILD: 0
      MACROSGROUPKEY: "147023059_918566284 Локальные макросы"
      OBJECTNAME: "gdc_frmExplorer"
      SERVERKEY: ~
      SHORTCUT: 0
      EDITIONDATE: 2020-04-14T11:32:06+03:00